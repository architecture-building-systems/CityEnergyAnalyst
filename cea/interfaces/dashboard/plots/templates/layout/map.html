{% extends "layout/layout_container.html" %}

{% import 'plot_widget_macros.html' as plot_widget_macros %}

{% block stylesheets %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('inputs_blueprint.static', filename='css/map.css') }}">
  <style>
    @media (min-width: 1200px) {
      #map-container {
        min-width: 1000px;
      }
    }
    .plot-widget {
      min-width: 500px;
    }
    .cea-plot {
      height: 500px;
    }

    #map-container {
      height: 500px;
    }
  </style>
{% endblock stylesheets %}

{% block layout %}
  <div class="row">
    <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12" id="map-container">
      <div class="x_panel">
        <div class="x_content">
          <div id="map-div" style="height: 450px;"></div>
        </div>
      </div>
    </div>
    {% for i in range(4) %}
      {% if dashboard.plots[i] is defined%}
        {{ plot_widget_macros.plot_widget(dashboard_index, i, dashboard.plots[i]) }}
      {% else %}
        {{ plot_widget_macros.plot_empty_widget() }}
      {% endif %}
    {% endfor %}
  </div>
{% endblock layout %}

{% block content %}
{{ super() }}
  <!-- modal dialogs for editing the dashboard -->

  <!-- replace plot -->
  <div class="modal fade" id="cea-dashboard-replace-plot" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close cea-modal-close" data-dismiss="modal"><span aria-hidden="true">Ã—</span>
          </button>
          <h4 class="modal-title">Change plot</h4>
        </div>
        <div class="modal-body">
          <form id="cea-dashboard-replace-plot-form" class="form-horizontal form-label-left" method="post"
                action="replace-plot/{{ dashboard_index }}">
            <div class="form-group">
              <label class="control-label" for="cea-plot-category-replace">Category</label>
              <select class="form-control" id="cea-plot-category-replace" name="category">
                {% for category in categories %}
                  <option value="{{ category }}" {% if category == "demand" %}selected{% endif %}>
                    {{ categories[category]['label'] }}
                  </option>
                {% endfor %}
              </select>
              <label class="control-label" for="cea-plot-name-replace">Plot</label>
              <select class="form-control" id="cea-plot-name-replace" name="plot-id">
                {% for plot in categories['demand']['plots'] %}
                  <option value="{{ plot['id'] }}">{{ plot['name'] }}</option>
                {% endfor %}
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default cea-modal-cancel" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-default cea-modal-ok" data-dismiss="modal"
                  onclick="$('#cea-dashboard-replace-plot-form').submit()">Change plot
          </button>
        </div>

      </div>
    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  {{ super() }}
  <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
  <script src="{{ url_for('inputs_blueprint.static', filename='vendor/turf.min.js') }}"></script>
  <script src="{{ url_for('inputs_blueprint.static', filename='js/mapclass.js') }}?u={{ last_updated }}"></script>
  <script src="{{ url_for('plots_blueprint.static', filename='js/map.js') }}?u={{ last_updated }}"></script>
{% endblock javascripts %}